.model small
.stack 100H

.data
BEAT DB  10/4,  10/4, 10/4, 10/4,  5,  5,  10/4,  10/4, 10/4, 10/4, 5,  5,10/4,  10/4, 10/4, 10/4,10/4,  10/4, 10/4, 10/4,10/4,  10/4, 10/4, 10/4,5,5;???????????? ???
FREQUENCY DW 262,277,294,311,330,349,370,392,415,440,466,494
; 1397,1319,1175,1047,1568,1568,1397,1319,1175,1047,1568,1568,1397,1760,1760,1397,1319,1568,1568,1319,1175,1319,1397,1175,1047,1047;???????????? ??????
MELODY DB 6,5,3,1,8,8,6,5,3,1,8,8,6,10,10,6,5,8,8,5,3,5,6,3,1,1, 0FFH; ????? ??????? ???


.code
start:
mov ax,@data
mov ds,ax

;---?????????????
PORT_B EQU 61H
COMMAND_REG EQU 43H
LATCH2 EQU 42H
IN AL,PORT_B ;???????? ??????? ??????
OR AL,00000011B ;????????? ??????? ? ??????
OUT PORT_B,AL ;???????? ????
MOV SI,0 ;?????????????? ?????????
MOV AL,0B6H ;????????? ??? ?????? 2
OUT COMMAND_REG,AL ;???????? ? ????????? ???????
;---??????? ????, ???????? ?? ??????? ? ???????? ? ????? 2
NEXT_NOTE:
LEA BX,MELODY ;????? ???????? ??? ???????
MOV AL,[BX][SI] ;????? ??? n-?? ???? ??????
CMP AL,0FFH ;???????? ?? ????? ??????
JE NO_MORE ;???? ????? ?? ?? ?????
CBW ;????????? ? ?????
;---????????? ???????
MOV BX,OFFSET FREQUENCY ;???????? ??????? ??????
DEC AX ;???????? ?????? ? 0
SHL AX,1 ;???????? ?? 2, ?.?. ?????
MOV DI,AX ;???????? ????? DI
MOV DX,[BX][DI] ;???????? ??????? ?? ???????
;???????? ?????????? ????
MOV AL,DL ;??????? ??????? ???? ???????
OUT LATCH2,AL ;???????? ???
MOV AL,DH ;??????? ??????? ???? ???????
OUT LATCH2,AL ;???????? ???
;---???????? ????? ????????
MOV AH,0 ;????? ??????? ?????? ????????
INT 1AH ;???????? ???????? ????????
MOV BX,OFFSET BEAT ;???????? ??????? ????
MOV CL,[BX][SI] ;????? ????? ????????? ????
MOV CH,0
MOV BX,DX ;????? ??????? ????? ????????
ADD BX,CX ;?????????? ?????? ?????????
STILL_SOUND:
INT 1AH ;????? ???????? ????????
CMP DX,BX ;?????????? ? ??????????
JNE STILL_SOUND ;???????-?????????? ????
INC SI ;????????? ? ????????? ????
JMP NEXT_NOTE ;
;---??????????
NO_MORE:
IN AL,PORT_B ;??????? ?????? ????? ?
AND AL,0FCH ;????????? ???????
OUT 61H,AL ;???????? ????

MOV AX,4C00H
INT 21H

END START